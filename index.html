<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>섀도우 링크 (Shadow Link)</title>
<style>
  body { text-align:center; font-family:Arial; background:#f0f0f0; }
  h1 { margin-top:20px; }
  #board { margin:20px auto; display:grid; grid-template-columns: repeat(8, 50px); grid-gap:2px; width:max-content; }
  .cell { width:50px; height:50px; background:#fff; border:1px solid #999; display:flex; align-items:center; justify-content:center; font-weight:bold; cursor:pointer; position:relative;}
  .token { width:40px; height:40px; border-radius:50%; }
  .highlight { outline:3px solid yellow; }
  #log { width:60%; height:120px; margin:20px auto; overflow-y:auto; border:1px solid #999; padding:10px; background:#fff; text-align:left;}
</style>
</head>
<body>
<h1>섀도우 링크 (Shadow Link)</h1>
<p>토큰 3개 직선 연결 시 승리합니다. 토큰 클릭 후 이동할 칸을 선택하세요.</p>
<div id="board"></div>
<div id="log"></div>

<script>
const boardSize=8;
let board=[];
let currentPlayer=0;
let selectedToken=null;
const logBox=document.getElementById("log");

function log(message){ logBox.innerHTML+=message+"<br>"; logBox.scrollTop=logBox.scrollHeight; }

const boardDiv=document.getElementById("board");

// 보드 초기화 및 렌더링
function createBoard(){
  boardDiv.innerHTML="";
  board=[];
  for(let r=0;r<boardSize;r++){
    for(let c=0;c<boardSize;c++){
      const cell={row:r,col:c,owner:null,div:null};
      const div=document.createElement("div");
      div.className="cell";
      div.dataset.row=r;
      div.dataset.col=c;
      div.onclick=()=>cellClick(r,c);
      cell.div=div;
      board.push(cell);
      boardDiv.appendChild(div);
    }
  }
}
createBoard();

// 초기 토큰 배치
function placeInitialTokens(){
  board.forEach(cell=>{
    if(cell.row<2){ cell.owner=0; }
    else if(cell.row>=boardSize-2){ cell.owner=1; }
  });
  renderBoard();
}
placeInitialTokens();

// 보드 렌더링
function renderBoard(){
  board.forEach(c=>{
    const div=c.div;
    div.innerHTML="";
    div.classList.remove("highlight");
    if(c.owner!==null){
      const token=document.createElement("div");
      token.className="token";
      token.style.background=c.owner===0?"black":"white";
      div.appendChild(token);
    }
  });
  if(selectedToken) highlightMoves(selectedToken);
}

// 클릭 처리
function cellClick(row,col){
  const cell=board.find(c=>c.row===row && c.col===col);
  if(selectedToken){
    if(cell.div.classList.contains("highlight")){
      // 이동
      cell.owner=currentPlayer;
      selectedToken.owner=null;
      log(`플레이어 ${currentPlayer+1} 이동 완료`);
      selectedToken=null;
      renderBoard();
      if(checkWin(currentPlayer)){ log(`🎉 플레이어 ${currentPlayer+1} 승리!`); return; }
      currentPlayer=(currentPlayer+1)%2;
      log(`턴 변경 → 플레이어 ${currentPlayer+1} 차례`);
    } else { log("유효한 칸을 선택하세요."); selectedToken=null; renderBoard(); }
  } else {
    if(cell.owner===currentPlayer){
      selectedToken=cell;
      renderBoard();
      log("토큰 선택됨");
    } else { log("자신의 토큰만 선택 가능합니다."); }
  }
}

// 이동 가능 칸 하이라이트
function highlightMoves(cell){
  const directions=[[-1,0],[1,0],[0,-1],[0,1]];
  directions.forEach(([dr,dc])=>{
    const nr=cell.row+dr, nc=cell.col+dc;
    if(nr>=0 && nr<boardSize && nc>=0 && nc<boardSize){
      const target=board.find(c=>c.row===nr && c.col===nc);
      if(target.owner===null) target.div.classList.add("highlight");
    }
  });
}

// 승리 체크 (가로, 세로, 대각선)
function checkWin(player){
  for(let r=0;r<boardSize;r++){
    for(let c=0;c<boardSize;c++){
      if(board.find(b=>b.row===r && b.col===c && b.owner===player)){
        if(checkLine(r,c,0,1,player)) return true; // 가로
        if(checkLine(r,c,1,0,player)) return true; // 세로
        if(checkLine(r,c,1,1,player)) return true; // 대각선 우하
        if(checkLine(r,c,1,-1,player)) return true; // 대각선 좌하
      }
    }
  }
  return false;
}

function checkLine(r,c,dr,dc,player){
  for(let i=1;i<3;i++){
    const nr=r+dr*i, nc=c+dc*i;
    if(nr<0||nr>=boardSize||nc<0||nc>=boardSize) return false;
    const cell=board.find(b=>b.row===nr && b.col===nc);
    if(!cell || cell.owner!==player) return false;
  }
  return true;
}

renderBoard();
log("게임 시작! 플레이어 1 차례");
</script>
</body>
</html>
