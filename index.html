<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì—ë„ˆì§€ ë§í¬ (Energy Link)</title>
  <style>
    body { text-align:center; font-family:Arial; background:#f0f0f0; }
    h1 { margin-top:20px; }
    #board { margin:20px auto; border:2px solid #333; display:grid; grid-template-columns: repeat(6, 60px); grid-gap:2px; background:#ccc; width: max-content; }
    .cell { width:60px; height:60px; background:#fff; display:flex; align-items:center; justify-content:center; font-weight:bold; cursor:pointer; border:1px solid #999; position:relative;}
    .player-token { width:20px; height:20px; border-radius:50%; position:absolute; bottom:2px; right:2px; }
    #hand { margin:20px auto; display:flex; gap:10px; justify-content:center; }
    .card { padding:10px; border-radius:6px; cursor:pointer; font-weight:bold; }
    .energy { color:#fff; }
    #log { width:60%; height:120px; margin:20px auto; overflow-y:auto; border:1px solid #999; padding:10px; background:#fff; text-align:left;}
    button { padding:8px 16px; margin:5px; cursor:pointer; border-radius:6px; border:none; background:#007bff; color:#fff; font-weight:bold;}
    button:hover { background:#0056b3; }
    #score { margin-top:10px; font-weight:bold;}
  </style>
</head>
<body>
  <h1>ğŸ® ì—ë„ˆì§€ ë§í¬ (Energy Link)</h1>
  <p>í„´ë³„ë¡œ ì—ë„ˆì§€ ì¹´ë“œë¥¼ ë†“ì•„ ë„¤íŠ¸ì›Œí¬ë¥¼ í™•ì¥í•˜ê³  ì ìˆ˜ë¥¼ íšë“í•˜ì„¸ìš”. íŠ¹ìˆ˜ ì¹´ë“œë¥¼ ì „ëµì ìœ¼ë¡œ ì‚¬ìš©!</p>
  <div id="score"></div>
  <div id="board"></div>
  <div id="hand"></div>
  <button onclick="endTurn()">í„´ ì¢…ë£Œ</button>
  <div id="log"></div>

<script>
const boardSize = 6;
let board = [];
let players = [
  {id:0, name:"í”Œë ˆì´ì–´1", color:"#e74c3c", hand:[], score:0},
  {id:1, name:"í”Œë ˆì´ì–´2", color:"#3498db", hand:[], score:0}
];
let currentPlayer = 0;
let deck = [];
let logBox = document.getElementById("log");
const energyColors = ["red","blue","yellow","green"];
const specialTypes = ["ë§‰í˜","ê°•í™”","ì „í™˜","ë¦¬ì…‹"];

// ë¡œê·¸
function log(message){ logBox.innerHTML += message+"<br>"; logBox.scrollTop = logBox.scrollHeight; }

// ë³´ë“œ ì´ˆê¸°í™”
const boardDiv = document.getElementById("board");
function createBoard(){
  board = [];
  boardDiv.innerHTML="";
  for(let r=0;r<boardSize;r++){
    for(let c=0;c<boardSize;c++){
      const cell = {row:r, col:c, owner:null, color:null};
      board.push(cell);
      const div = document.createElement("div");
      div.className="cell";
      div.dataset.row=r;
      div.dataset.col=c;
      div.onclick=()=>cellClick(r,c);
      boardDiv.appendChild(div);
    }
  }
}
createBoard();

// ë± ìƒì„±
function createDeck(){
  deck=[];
  for(let i=0;i<energyColors.length;i++){
    for(let j=0;j<6;j++) deck.push({type:"energy", color:energyColors[i]});
  }
  for(let i=0;i<specialTypes.length;i++){
    for(let j=0;j<4;j++) deck.push({type:"special", name:specialTypes[i]});
  }
  deck.sort(()=>Math.random()-0.5);
}
createDeck();

// ì¹´ë“œ ë½‘ê¸°
function drawCard(player){
  if(deck.length===0) createDeck();
  const card = deck.pop();
  player.hand.push(card);
  renderHand();
}

// ì´ˆê¸° ì¹´ë“œ 3ì¥ì”©
players.forEach(p=>{ drawCard(p); drawCard(p); drawCard(p); });

// í•¸ë“œ ë Œë”ë§
const handDiv = document.getElementById("hand");
let selectedCardIndex = null;
function renderHand(){
  handDiv.innerHTML="";
  players[currentPlayer].hand.forEach((card,i)=>{
    const cdiv=document.createElement("div");
    cdiv.className="card";
    cdiv.innerText=card.type==="energy"?card.color:card.name;
    cdiv.style.background=card.type==="energy"?card.color:"#555";
    cdiv.style.color=card.type==="energy"?"#fff":"#fff";
    cdiv.onclick=()=>{ selectedCardIndex=i; };
    handDiv.appendChild(cdiv);
  });
  updateScore();
}

// ì ìˆ˜ ê³„ì‚°
function updateScore(){
  players.forEach(p=>{
    let total=0;
    board.forEach(cell=>{
      if(cell.owner===p.id && cell.color===cell.color){
        total++; // ê¸°ë³¸ 1ì /ì…€
      }
    });
    p.score=total;
  });
  document.getElementById("score").innerText=players.map(p=>`${p.name}: ${p.score}`).join(" | ");
}

// ì…€ í´ë¦­ ì²˜ë¦¬
function cellClick(row,col){
  if(selectedCardIndex===null){ log("ì¹´ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”."); return;}
  const cell = board.find(c=>c.row===row && c.col===col);
  if(cell.owner!==null){ log("ì´ë¯¸ ì°¨ì§€ëœ ì¹¸ì…ë‹ˆë‹¤."); return;}
  const card = players[currentPlayer].hand[selectedCardIndex];
  if(card.type==="energy"){
    cell.owner=currentPlayer;
    cell.color=card.color;
    players[currentPlayer].hand.splice(selectedCardIndex,1);
    selectedCardIndex=null;
    renderBoard();
    renderHand();
    log(`${players[currentPlayer].name}ì´ ${card.color} ì—ë„ˆì§€ ë†“ìŒ.`);
  } else {
    // íŠ¹ìˆ˜ ì¹´ë“œ
    if(card.name==="ë§‰í˜"){
      cell.owner=2; // 2=ë§‰í˜
      cell.color="#000";
      log(`${players[currentPlayer].name}ì´ ë§‰í˜ ì¹´ë“œë¥¼ ì‚¬ìš©í•¨.`);
    } else if(card.name==="ê°•í™”"){
      cell.owner=currentPlayer;
      cell.color="#fff";
      log(`${players[currentPlayer].name}ì´ ê°•í™” ì¹´ë“œë¥¼ ì‚¬ìš©í•¨ (ì ìˆ˜ ë‘ ë°°).`);
    } else if(card.name==="ì „í™˜"){
      if(cell.owner===currentPlayer){
        const newColor=energyColors[Math.floor(Math.random()*4)];
        cell.color=newColor;
        log(`${players[currentPlayer].name}ì´ ì „í™˜ ì¹´ë“œë¡œ ìƒ‰ ë³€ê²½: ${newColor}`);
      } else { log("ìì‹  ì¹¸ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥"); return;}
    } else if(card.name==="ë¦¬ì…‹"){
      if(cell.owner===currentPlayer){
        cell.owner=null; cell.color=null;
        log(`${players[currentPlayer].name}ì´ ë¦¬ì…‹ ì¹´ë“œ ì‚¬ìš©`);
      } else { log("ìì‹  ì¹¸ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥"); return;}
    }
    players[currentPlayer].hand.splice(selectedCardIndex,1);
    selectedCardIndex=null;
    renderBoard();
    renderHand();
  }
}

// ë³´ë“œ ë Œë”ë§
function renderBoard(){
  board.forEach(c=>{
    const div = document.querySelector(`.cell[data-row='${c.row}'][data-col='${c.col}']`);
    if(c.owner===null){ div.style.background="#fff"; div.innerText=""; div.innerHTML=""; }
    else if(c.owner===2){ div.style.background="#000"; div.innerText="X"; }
    else{ div.style.background=c.color; div.innerText=""; }
  });
  updateScore();
}

// í„´ ì¢…ë£Œ
function endTurn(){
  drawCard(players[currentPlayer]);
  currentPlayer=(currentPlayer+1)%players.length;
  log(`í„´ ì¢…ë£Œ â†’ ${players[currentPlayer].name} ì°¨ë¡€`);
  renderHand();
}

renderBoard();
renderHand();
log("ê²Œì„ ì‹œì‘! í”Œë ˆì´ì–´1 ì°¨ë¡€");
</script>
</body>
</html>
